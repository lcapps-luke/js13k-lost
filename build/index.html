<!DOCTYPE html><html lang=en><head><meta charset=utf-8><script src=aframe.min.js></script><script>function SfxrParams(){this.setSettings=function(t){for(var i=0;i<24;i++)this[String.fromCharCode(97+i)]=t[i]||0;this.c<.01&&(this.c=.01);var e=this.b+this.c+this.e;if(e<.18){var h=.18/e;this.b*=h,this.c*=h,this.e*=h}}}function SfxrSynth(){this._params=new SfxrParams;var t,i,e,h,a,o,r,s,n,l,d,y;this.reset=function(){var t=this._params;h=100/(t.f*t.f+.001),a=100/(t.g*t.g+.001),o=1-t.h*t.h*t.h*.01,r=-t.i*t.i*t.i*1e-6,t.a||(d=.5-t.n/2,y=5e-5*-t.o),s=1+t.l*t.l*(t.l>0?-.9:10),n=0,l=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.totalReset=function(){this.reset();var h=this._params;return t=h.b*h.b*1e5,i=h.c*h.c*1e5,e=h.e*h.e*1e5+12,3*((t+i+e)/3|0)},this.synthWave=function(c,x){var g=this._params,p=1!=g.s||g.v,w=g.v*g.v*.1,u=1+3e-4*g.w,v=g.s*g.s*g.s*.1,m=1+1e-4*g.t,f=1!=g.s,b=g.x*g.x,z=g.g,k=g.q||g.r,A=g.r*g.r*g.r*.2,C=g.q*g.q*(g.q<0?-1020:1020),E=g.p?32+((1-g.p)*(1-g.p)*2e4|0):0,S=g.d,L=g.j/2,j=g.k*g.k*.01,D=g.a,M=t,P=1/t,R=1/i,q=1/e,F=5/(1+g.u*g.u*20)*(.01+v);F>.8&&(F=.8),F=1-F;for(var B,V,N,T,_,H,W=!1,O=0,U=0,G=0,I=0,J=0,K=0,Q=0,X=0,Y=0,Z=0,$=new Array(1024),tt=new Array(32),it=$.length;it--;)$[it]=0;for(it=tt.length;it--;)tt[it]=2*Math.random()-1;for(it=0;it<x;it++){if(W)return it;if(E&&++Y>=E&&(Y=0,this.reset()),l&&++n>=l&&(l=0,h*=s),o+=r,(h*=o)>a&&(h=a,z>0&&(W=!0)),V=h,L>0&&(Z+=j,V*=1+Math.sin(Z)*L),(V|=0)<8&&(V=8),D||((d+=y)<0?d=0:d>.5&&(d=.5)),++U>M)switch(U=0,++O){case 1:M=i;break;case 2:M=e}switch(O){case 0:G=U*P;break;case 1:G=1+2*(1-U*R)*S;break;case 2:G=1-U*q;break;case 3:G=0,W=!0}k&&((N=0|(C+=A))<0?N=-N:N>1023&&(N=1023)),p&&u&&((w*=u)<1e-5?w=1e-5:w>.1&&(w=.1)),H=0;for(var et=8;et--;){if(++Q>=V&&(Q%=V,3==D))for(var ht=tt.length;ht--;)tt[ht]=2*Math.random()-1;switch(D){case 0:_=Q/V<d?.5:-.5;break;case 1:_=1-Q/V*2;break;case 2:_=.225*(((_=1.27323954*(T=6.28318531*((T=Q/V)>.5?T-1:T))+.405284735*T*T*(T<0?1:-1))<0?-1:1)*_*_-_)+_;break;case 3:_=tt[Math.abs(32*Q/V|0)]}p&&(B=K,(v*=m)<0?v=0:v>.1&&(v=.1),f?(J+=(_-K)*v,J*=F):(K=_,J=0),I+=(K+=J)-B,_=I*=1-w),k&&($[X%1024]=_,_+=$[(X-N+1024)%1024],X++),H+=_}H*=.125*G*b,c[it]=H>=1?32767:H<=-1?-32768:32767*H|0}return x}}var synth=new SfxrSynth,jsfxr=function(t){synth._params.setSettings(t);var i=synth.totalReset(),e=new Uint8Array(4*((i+1)/2|0)+44),h=2*synth.synthWave(new Uint16Array(e.buffer,44),i),a=new Uint32Array(e.buffer,0,44);a[0]=1179011410,a[1]=h+36,a[2]=1163280727,a[3]=544501094,a[4]=16,a[5]=65537,a[6]=44100,a[7]=88200,a[8]=1048578,a[9]=1635017060,a[10]=h,h+=44;for(var o=0,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s="data:audio/wav;base64,";o<h;o+=3){var n=e[o]<<16|e[o+1]<<8|e[o+2];s+=r[n>>18]+r[n>>12&63]+r[n>>6&63]+r[63&n]}return s};"function"==typeof require?module.exports=jsfxr:this.jsfxr=jsfxr;var LevelDef={template:{navNode:{type:"a-entity",attr:{geometry:"primitive:circle",material:"shader:flat;flatShading:true",lookat:"#player",class:"clickable",navigation:""}},tree:{type:"a-entity",attr:{shadow:""},children:[{type:"a-entity",attr:{geometry:"radius:0.8;height:6;primitive:cylinder",material:"color:#804000;roughness:1",position:"0 3 0"}},{type:"a-entity",attr:{geometry:"radius:2.3;primitive:sphere",position:"0 7.5 0",material:"color:#008000;roughness:1"}}]}},maze:{"hub.json":{width:512,height:512,floor:[{x:0,y:0,width:512,height:512}],solid:[{x:192,y:0,width:160,height:32},{x:320,y:32,width:32,height:96},{x:288,y:128,width:64,height:32},{x:320,y:160,width:64,height:32},{x:352,y:192,width:32,height:64},{x:384,y:192,width:128,height:32},{x:480,y:224,width:32,height:128},{x:384,y:320,width:96,height:32},{x:352,y:288,width:32,height:96},{x:288,y:352,width:64,height:32},{x:320,y:384,width:32,height:128},{x:192,y:480,width:128,height:32},{x:160,y:384,width:32,height:128},{x:128,y:352,width:96,height:32},{x:128,y:288,width:32,height:64},{x:32,y:320,width:96,height:32},{x:0,y:224,width:32,height:128},{x:0,y:192,width:128,height:32},{x:128,y:160,width:32,height:96},{x:160,y:128,width:32,height:64},{x:192,y:128,width:64,height:32},{x:192,y:32,width:32,height:96}],nav:[{x:272,y:80},{x:432,y:272},{x:80,y:272},{x:256,y:432},{x:256,y:256},{x:272,y:176},{x:336,y:272},{x:176,y:272},{x:256,y:336}],switch:[],door:[{x:224,y:360,width:64,height:16,name:"",openPos:{x:65,y:0}}],trans:[{x:32,y:240,level:"left.json",side:"r",player:{x:0,y:0}},{x:240,y:128,level:"",side:"u",player:{x:0,y:0}},{x:384,y:240,level:"",side:"l",player:{x:0,y:0}},{x:128,y:304,level:"",side:"l",player:{x:0,y:0}},{x:480,y:304,level:"right.json",side:"l",player:{x:7.813,y:45.313}}],lvlDoor:[{x:256,y:136,width:32,height:16,openPos:{x:33,y:0}},{x:360,y:256,width:16,height:32,openPos:{x:0,y:-33}},{x:136,y:256,width:16,height:32,openPos:{x:0,y:33}}]},"left.json":{width:1024,height:1024,floor:[{x:0,y:0,width:1024,height:1024}],solid:[{x:576,y:448,width:32,height:128},{x:448,y:544,width:128,height:32},{x:448,y:416,width:32,height:128},{x:480,y:416,width:128,height:32}],nav:[],switch:[{x:528,y:496,type:"global",target:"test"}],door:[],trans:[],lvlDoor:[]},"right.json":{width:1024,height:1024,floor:[{x:0,y:0,width:1024,height:1024}],solid:[{x:0,y:480,width:32,height:352},{x:800,y:0,width:160,height:32},{x:992,y:608,width:32,height:288},{x:512,y:992,width:448,height:32},{x:32,y:512,width:96,height:64},{x:128,y:128,width:64,height:224},{x:192,y:128,width:128,height:64},{x:96,y:64,width:256,height:32},{x:352,y:64,width:64,height:128},{x:256,y:224,width:64,height:128},{x:352,y:288,width:64,height:64},{x:704,y:320,width:96,height:128},{x:832,y:352,width:96,height:96},{x:416,y:704,width:64,height:160},{x:320,y:640,width:64,height:224},{x:288,y:512,width:192,height:96},{x:416,y:608,width:64,height:64},{x:384,y:640,width:32,height:32},{x:288,y:352,width:32,height:64},{x:448,y:320,width:96,height:128},{x:320,y:384,width:96,height:32},{x:416,y:384,width:32,height:64},{x:64,y:64,width:32,height:128},{x:32,y:192,width:96,height:224},{x:384,y:32,width:352,height:32},{x:704,y:64,width:32,height:192},{x:736,y:224,width:64,height:32},{x:736,y:32,width:96,height:160},{x:832,y:128,width:32,height:96},{x:832,y:224,width:96,height:96},{x:896,y:128,width:64,height:64},{x:928,y:32,width:32,height:96},{x:960,y:160,width:32,height:352},{x:896,y:480,width:64,height:64},{x:832,y:448,width:32,height:96},{x:640,y:480,width:192,height:64},{x:640,y:640,width:128,height:128},{x:512,y:768,width:160,height:64},{x:704,y:800,width:64,height:64},{x:224,y:896,width:64,height:64},{x:128,y:800,width:64,height:64},{x:128,y:576,width:64,height:128},{x:32,y:800,width:64,height:96},{x:64,y:896,width:128,height:96},{x:160,y:992,width:192,height:32},{x:320,y:896,width:224,height:96},{x:416,y:864,width:128,height:32},{x:544,y:864,width:64,height:32},{x:576,y:928,width:96,height:32},{x:640,y:832,width:32,height:96},{x:704,y:896,width:128,height:96},{x:896,y:864,width:96,height:32},{x:928,y:896,width:32,height:96},{x:800,y:800,width:64,height:96},{x:864,y:800,width:96,height:32},{x:928,y:672,width:32,height:128},{x:800,y:672,width:128,height:32},{x:800,y:704,width:32,height:64},{x:832,y:736,width:64,height:32},{x:640,y:544,width:352,height:96},{x:576,y:352,width:96,height:128},{x:416,y:480,width:224,height:32},{x:512,y:544,width:96,height:32},{x:512,y:576,width:32,height:96},{x:544,y:608,width:96,height:64},{x:512,y:704,width:32,height:64},{x:544,y:704,width:64,height:32},{x:128,y:480,width:32,height:96},{x:128,y:352,width:32,height:96},{x:320,y:224,width:160,height:32},{x:416,y:288,width:416,height:32},{x:448,y:96,width:32,height:128},{x:480,y:96,width:192,height:32},{x:640,y:128,width:32,height:128},{x:512,y:224,width:128,height:32},{x:512,y:160,width:32,height:64},{x:544,y:160,width:64,height:32},{x:256,y:576,width:32,height:160},{x:64,y:736,width:160,height:32},{x:64,y:608,width:32,height:128},{x:224,y:736,width:64,height:128},{x:0,y:192,width:32,height:256},{x:8,y:448,width:16,height:32}],nav:[{x:80,y:464},{x:176,y:464},{x:224,y:384},{x:224,y:544},{x:272,y:464},{x:400,y:464},{x:560,y:464},{x:560,y:336},{x:688,y:336},{x:688,y:464},{x:816,y:464},{x:816,y:336},{x:944,y:336},{x:944,y:464},{x:880,y:464},{x:944,y:208},{x:880,y:208},{x:880,y:80},{x:224,y:720},{x:112,y:720},{x:112,y:592},{x:48,y:592},{x:48,y:784},{x:112,y:784},{x:208,y:784},{x:112,y:880},{x:208,y:880},{x:304,y:880},{x:304,y:976},{x:208,y:976},{x:304,y:752},{x:304,y:624},{x:400,y:880},{x:400,y:688},{x:400,y:784},{x:496,y:688},{x:624,y:688},{x:624,y:752},{x:560,y:752},{x:496,y:784},{x:496,y:848},{x:624,y:848},{x:624,y:912},{x:560,y:912},{x:560,y:976},{x:688,y:976},{x:688,y:880},{x:688,y:784},{x:784,y:784},{x:784,y:880},{x:912,y:784},{x:912,y:720},{x:784,y:656},{x:976,y:656},{x:976,y:848},{x:880,y:848},{x:880,y:944},{x:976,y:752},{x:880,y:656},{x:224,y:208},{x:336,y:208},{x:336,y:112},{x:208,y:112},{x:112,y:112},{x:432,y:208},{x:432,y:80},{x:688,y:80},{x:688,y:272},{x:496,y:272},{x:496,y:144},{x:624,y:144},{x:624,y:208},{x:336,y:272},{x:368,y:368},{x:432,y:368},{x:816,y:272},{x:816,y:208},{x:496,y:528},{x:624,y:528},{x:624,y:592}],switch:[{x:880,y:976,type:"door",target:"door_1"},{x:880,y:48,type:"variable",target:"right_open"}],door:[{x:928,y:256,width:32,height:32,name:"door_1",openPos:{x:-33,y:0}}],trans:[{x:32,y:432,level:"hub.json",side:"r",player:{x:42.188,y:26.563}},{x:128,y:496,level:"",side:"l",player:{}}],lvlDoor:[{x:136,y:448,width:16,height:32,openPos:{x:0,y:-33}}]}},level:{"hub.json":{player:{x:26.563,y:1.6,z:7.813},objects:[{type:"a-entity",attr:{maze:"maze: hub.json; size: 50 50 5",position:"0 0 0"}},{type:"a-plane",attr:{rotation:"90 0 0",width:"50",height:"50",color:"#ccc",shadow:"",position:"25 5 25"}}]},"left.json":{player:{x:0,y:1.6,z:0},objects:[{type:"a-entity",attr:{maze:"maze: left.json; size: 100 100 5",position:"0 0 0"}}]},"right.json":{player:{x:7.8125,y:1.6,z:45.3125},objects:[{type:"a-entity",attr:{maze:"maze: right.json; size: 100 100 5",position:"0 0 0"}},{type:"a-plane",attr:{rotation:"90 0 0",width:"100",height:"100",color:"#ccc",shadow:"",position:"50 5 50"}}]},"start.json":{player:{x:-9,y:1.6,z:0},objects:[{type:"a-sky",attr:{color:"#00AAEE"}},{type:"a-entity",attr:{light:"shadowCameraRight:44; shadowCameraLeft:-30; shadowCameraTop:26; shadowCameraBottom:-31; shadowCameraFar:150; shadowCameraNear:0; castShadow:true; shadowMapHeight: 512; shadowMapWidth: 512;",position:"-30 40 -15"}},{type:"a-entity",attr:{light:"intensity:0.15;type:ambient"}},{type:"a-plane",attr:{rotation:"-90 0 0",width:"100",height:"100",color:"#009b00",shadow:""}},{type:"a-box",attr:{position:"5 2.5 -2.5",color:"#4CC3D9",material:"",geometry:"height:5;width:10",shadow:"",class:"solid"}},{type:"a-box",attr:{position:"5 5.5 0",rotation:"90 0 0",color:"#4CC3D9",material:"",geometry:"height:5;width:10",shadow:"",class:"solid"}},{type:"a-box",attr:{position:"5 2.5 2.5",color:"#4CC3D9",material:"",geometry:"height:5;width:10",shadow:"",class:"solid"}},{type:"a-box",attr:{position:"9.392 2 -1.954",geometry:"depth:0.3;width:0.2;height:0.2",switch:"target:#door; event:open",class:"clickable",clickableupdator:"1500",lostsound:"snd:click; on: click"}},{type:"a-entity",attr:{position:"10.246 2.524 0",id:"door",geometry:"width:0.5;height:5;depth:4",class:"solid"},children:[{type:"a-animation",attr:{begin:"open",attribute:"position",from:"10.246 2.524 0",to:"10.246 2.524 4",duration:"1500",easing:"ease-in",fill:"forwards"}}]},{type:"a-entity",attr:{position:"-15 0 -25",forest:"30 20"}},{type:"a-entity",attr:{position:"-15 0 3",forest:"30 20"}},{type:"a-entity",attr:{position:"-35 0 -27",forest:"20 50"}},{type:"a-entity",attr:{position:"-38 4 -0",rotation:"0 90 0",geometry:"width:60;height:8;primitive:plane",material:"color:#391d00;shader:flat"}},{type:"a-entity",attr:{position:"20 4 -0",rotation:"0 270 0",geometry:"width:60;height:8;primitive:plane",material:"color:#391d00;shader:flat"}},{type:"a-entity",attr:{position:"-9 4 -28",rotation:"0 0 0",geometry:"width:60;height:8;primitive:plane",material:"color:#391d00;shader:flat"}},{type:"a-entity",attr:{position:"-9 4 28",rotation:"0 180 0",geometry:"width:60;height:8;primitive:plane",material:"color:#391d00;shader:flat"}},{template:"navNode",attr:{position:"-9 2 0",visible:"false"}},{template:"navNode",attr:{position:"0 2 0"}},{template:"navNode",attr:{position:"6.5 2 0"}},{template:"navNode",attr:{position:"13 2 0"}},{type:"a-entity",attr:{geometry:"primitive:circle",material:"shader:flat;flatShading:true",lookat:"#player",class:"clickable",levelchange:"level:hub.json; position:0 1.6 0",position:"13 2 3"}}]}}};AFRAME.registerComponent("clickableupdator",{schema:{type:"number",default:0},init:function(){this.timer=this.data,this.running=!1;var t=this;this.el.addEventListener("click",function(){t.onClick()}),console.log("updator for "+this.timer)},onClick:function(){this.timer=this.data,this.running=!0,console.log("updator triggered "+this.timer)},tick:function(t,i){if(this.running&&(this.timer-=i,this.timer<=0)){this.running=!1;var e=this.el.sceneEl.querySelector("#player");e.emit("move",e.getAttribute("position")),console.log("update!!!")}}}),AFRAME.registerComponent("forest",{schema:{type:"vec2"},init:function(){this.el;for(var t=this.data.x,i=this.data.y,e=0;e<t;e+=3.6)for(var h=0;h<i;h+=3.6){var a=e+.8+2*Math.random(),o=h+.8+2*Math.random(),r=-3*Math.random(),s=SceneBuilder.buildElement(LevelDef.template.tree);s.setAttribute("position",a+" "+r+" "+o),this.el.appendChild(s)}}}),AFRAME.registerComponent("levelchange",{schema:{level:{type:"string"},delay:{type:"number",default:0},position:{type:"vec3"}},init:function(){var t=this;this.el&&this.el.addEventListener("click",function(){t.transition()}),this.timer=this.data.delay,this.lit=!1,this.triggered=!1},tick:function(t,i){this.lit&&(this.timer-=i,this.timer<=0&&(this.el.sceneEl.emit("changeLevel",{level:this.data.level,position:this.data.position},!1),this.lit=!1))},transition:function(){this.triggered||(this.lit=!0,this.triggered=!0)}}),AFRAME.registerComponent("lookat",{schema:{type:"selector",default:"[camera]"},init:function(){this.target=null},update:function(){if(this.data){if(!this.data.hasLoaded){var t=this;return t.data.addEventListener("loaded",function(){t.target=t.data.object3D})}this.target=this.data.object3D}},tick:function(){if(this.target){var t=this.el.object3D.parent.worldToLocal(this.target.getWorldPosition()),i=null;this.el.getObject3D("camera")?i.subVectors(this.el.object3D.position,t).add(this.el.object3D.position):i=t,this.el.object3D.lookAt(i)}}}),AFRAME.registerComponent("lostsound",{schema:{snd:{type:"string"},on:{type:"string"}},init:function(){this.el.setAttribute("sound","src: url("+SoundLibrary[this.data.snd]+"); on: "+this.data.on)}}),AFRAME.registerComponent("lost",{init:function(){this.clickableList=[],window.lostVars={leftDone:!1,rightDone:!1},this.mazeCount=0,this.mazeLoaded=0;var t=this;this.el.addEventListener("changeLevel",function(i){t.loadScene(i.detail.level,i.detail.position)}),this.el.addEventListener("setVariable",function(i){t.onSetVariable(i.detail[0],i.detail[1])}),this.el.addEventListener("mazeLoaded",function(i){t.onMazeLoaded()}),this.player=this.el.sceneEl.querySelector("#player"),this.player.addEventListener("move",function(i){t.onPlayerMove(i.detail)}),this.loadScene("hub.json")},tick:function(t,i){},loadScene:function(t,i){var e=this.el;this.mazeLoaded=0;for(var h=e.querySelectorAll("a-scene>.vr:not(.global)"),a=0;a<h.length;a++)e.removeChild(h[a]);var o=LevelDef.level[t],r=i||o.player;this.player.setAttribute("position",r),SceneBuilder.buildChildren(e,o.objects);var s=e.querySelectorAll("[maze]");this.mazeCount=s.length,0==this.mazeCount&&(this.clickableList=e.querySelectorAll(".clickable"),this.onPlayerMove(r),e.emit("loaded"))},onMazeLoaded:function(){if(this.mazeLoaded++,this.mazeCount==this.mazeLoaded){this.clickableList=this.el.querySelectorAll(".clickable"),console.log(this.clickableList);var t=this.player.getAttribute("position");this.onPlayerMove(t),this.el.emit("loaded")}console.log("maze loaded "+this.mazeLoaded+" of "+this.mazeCount)},onPlayerMove:function(t){var i=this.el,e=new THREE.Raycaster;e.near=0;for(var h=new THREE.Vector3(t.x,t.y,t.z),a=i.querySelectorAll(".solid"),o=[],r=0;r<a.length;r++)o.push(a[r].object3D);for(r=0;r<this.clickableList.length;r++){var s=this.clickableList[r];if(s.getAttribute("position")){var n=!1,l=new THREE.Vector3;l.setFromMatrixPosition(s.object3D.matrixWorld);var d=h.distanceTo(l);if(d<=20){var y=new THREE.Vector3;y.subVectors(l,h).normalize(),e.far=d,e.set(h,y),0==e.intersectObjects(o,!0).length&&(n=!0)}var c=s.classList.contains("clickable");c&&!n?s.classList.remove("clickable"):!c&&n&&s.classList.add("clickable")}}i.querySelector("#player>.cursor").components.raycaster.refreshObjects()},onSetVariable:function(t,i){window.lostVars[t]=i}}),AFRAME.registerComponent("maze",{schema:{maze:{type:"string"},size:{type:"vec3"}},init:function(){var t=LevelDef.maze[this.data.maze];this.build(t),this.el.sceneEl.emit("mazeLoaded")},build:function(t){console.log(t);for(var i in t.floor)this.buildFloor(t.floor[i],t.width,t.height);for(var i in t.solid)this.buildSolid(t.solid[i],t.width,t.height);for(var i in t.nav)this.buildNav(t.nav[i],t.width,t.height);for(var i in t.door)this.buildDoor(t.door[i],t.width,t.height);for(var i in t.switch)this.buildSwitch(t.switch[i],t.width,t.height);for(var i in t.trans)this.buildTrans(t.trans[i],t.width,t.height);for(var i in t.lvlDoor)this.buildLvlDoor(t.lvlDoor[i],t.width,t.height)},buildFloor:function(t,i,e){var h=t.width/i*this.data.size.x,a=t.height/e*this.data.size.y,o={type:"a-plane",attr:{rotation:"-90 0 0",position:t.x/i*this.data.size.x+h/2+" 0 "+(t.y/e*this.data.size.y+a/2),width:h,height:a,color:"#777",shadow:""}};this.el.appendChild(SceneBuilder.buildElement(o))},buildSolid:function(t,i,e){var h=t.width/i*this.data.size.x,a=t.height/e*this.data.size.y,o=t.x/i*this.data.size.x+h/2,r=t.y/e*this.data.size.y+a/2,s={type:"a-box",attr:{position:o+" "+this.data.size.z/2+" "+r,width:h,height:this.data.size.z,depth:a,color:"#aaa",shadow:"",class:"solid"}};this.el.appendChild(SceneBuilder.buildElement(s))},buildNav:function(t,i,e){var h={template:"navNode",attr:{position:t.x/i*this.data.size.x+" 2 "+t.y/e*this.data.size.y}};this.el.appendChild(SceneBuilder.buildElement(h))},buildDoor:function(t,i,e){var h=t.width/i*this.data.size.x,a=t.height/e*this.data.size.y,o=t.x/i*this.data.size.x+h/2,r=t.y/e*this.data.size.y+a/2,s=this.data.size.z/2,n=o+t.openPos.x/i*this.data.size.x,l=r+t.openPos.y/e*this.data.size.y,d={type:"a-box",attr:{position:o+" "+s+" "+r,width:h,height:this.data.size.z,depth:a,color:"#ccc",shadow:"",class:"solid",id:t.name},children:[{type:"a-animation",attr:{begin:"open",attribute:"position",from:o+" "+s+" "+r,to:n+" "+s+" "+l,duration:1500,easing:"ease-in",fill:"forwards"}}]};this.el.appendChild(SceneBuilder.buildElement(d))},buildSwitch:function(t,i,e){var h=t.x/i*this.data.size.x,a=t.y/e*this.data.size.y,o=(t.type,{type:"a-entity",attr:{position:h+" 0.5 "+a,shadow:""},children:[{type:"a-box",attr:{width:.5,height:1,depth:.5,color:"#aaa"}},{type:"a-sphere",attr:{position:"0 0.5 0",radius:.2,color:"#f00",switch:"target: "+("global"==t.type?"a-scene":"#"+t.target)+"; event: "+("door"==t.type?"open":"setVariable")+("global"==t.type?"; data: "+t.target+", true":""),class:"clickable",lostsound:"snd:click; on: click"}}]});this.el.appendChild(SceneBuilder.buildElement(o))},buildTrans:function(t,i,e){var h=0,a=0;"u"==t.side&&(a=-.1),"r"==t.side&&(h=.1),"d"==t.side&&(a=.1),"l"==t.side&&(h=-.1);var o=t.x/i*this.data.size.x+h,r=t.y/e*this.data.size.y+a,s=.2+h,n=.2+a,l=t.player.x,d=t.player.y,y={type:"a-box",attr:{position:o+" 2 "+r,class:"clickable",lostsound:"snd:click; on: click",geometry:"depth:"+n+";width:"+s+";height:0.2"}};""!=t.level&&(y.attr.levelchange="level: "+t.level+"; position: "+l+" 1.6 "+d),this.el.appendChild(SceneBuilder.buildElement(y))},buildLvlDoor:function(t,i,e){var h=t.width/i*this.data.size.x,a=t.height/e*this.data.size.y,o=t.x/i*this.data.size.x+h/2,r=t.y/e*this.data.size.y+a/2,s=this.data.size.z/2,n=o+t.openPos.x/i*this.data.size.x,l=r+t.openPos.y/e*this.data.size.y,d={type:"a-box",attr:{position:o+" "+s+" "+r,width:h,height:this.data.size.z,depth:a,color:"#ccc",shadow:"",class:"solid",id:t.name},children:[{type:"a-animation",attr:{attribute:"position",from:o+" "+s+" "+r,to:n+" "+s+" "+l,duration:1500,easing:"ease-in",fill:"forwards"}}]};this.el.appendChild(SceneBuilder.buildElement(d))}}),AFRAME.registerComponent("navigation",{init:function(){var t=this;this.el&&this.el.addEventListener("click",function(){t.click()})},click:function(){var t=this.el.sceneEl.querySelector("#player"),i=this.el.getAttribute("position"),e=t.getAttribute("position"),h=i.x+" "+e.y+" "+i.z,a=document.createElement("a-animation");a.setAttribute("attribute","position"),a.setAttribute("to",h),a.setAttribute("dur","500"),a.setAttribute("repeat","0"),t.appendChild(a),this.el.setAttribute("visible",!1);for(var o=this.el.sceneEl.querySelectorAll("[navigation]"),r=0;r<o.length;r++){var s=o[r];s!==this.el&&s.setAttribute("visible",!0)}t.emit("move",i)}});var SceneBuilder=function(){function t(t,i){var e={};if("attr"in t)for(var h in t.attr)e[h]=t.attr[h];if("attr"in i)for(var h in i.attr)e[h]=i.attr[h];return e}function i(t,i,e){return t in i?i[t]:e[t]}function e(e){var a={};"template"in e&&(a=LevelDef.template[e.template]);var o=document.createElement(i("type",e,a)),r=t(a,e);for(var s in r)o.setAttribute(s,r[s]);return"children"in a&&h(o,a.children),"children"in e&&h(o,e.children),o.classList.add("vr"),o}function h(t,i){for(var h=0;h<i.length;h++){var a=e(i[h]);t.appendChild(a)}}return{buildElement:e,buildChildren:h}}(),SoundLibrary=function(){var t={click:[0,.16,.184,.944,.144,.272,.16,-.008,-.472,.16,.4479,-.2319,.472,.368,.008,,.04,.328,1,.072,.944,,.008,.5]},i={};for(var e in t)i[e]=jsfxr(t[e]);return i}();AFRAME.registerComponent("switch",{schema:{target:{type:"selector"},event:{type:"string"},data:{type:"array"}},init:function(){var t=this;this.el&&this.el.addEventListener("click",function(){t.onClick()})},onClick:function(){this.data.target.emit(this.data.event,this.data.data)}});</script></head><body><a-scene lost><a-entity id=player position="-9 0 0" camera=userHeight:1.6 wasd-controls rotation="0 270 0" look-controls class=global><a-entity class=cursor cursor="fuse: true; fuseTimeout: 500;" position="0 0 -1" geometry="primitive:circle; radius: 0.2;" material="color: cyan; shader: flat;" scale="0.1 0.1 0.1" raycaster="objects:.clickable; far:20"><a-animation begin=fusing end=mouseleave easing=ease-in attribute=scale from="0.5 0.5 0.5" to="0.1 0.1 0.1" fill=backwards dur=500></a-animation></a-entity></a-entity></a-scene></body></html>