<!DOCTYPE html><html lang=en><head><meta charset=utf-8><script src=https://aframe.io/releases/0.6.1/aframe.min.js></script><script>var LevelDef={template:{navNode:{type:"a-entity",attr:{geometry:"primitive:circle",material:"shader:flat;flatShading:true",lookat:"#player",class:"clickable",navigation:""}}},level:{"start.json":[{type:"a-sky",attr:{color:"#00AAEE"}},{type:"a-entity",attr:{light:"shadowCameraRight: 16.82; shadowCameraLeft: -22.24; shadowCameraTop: 13; shadowCameraBottom: -13.31; shadowCameraFar: 499.82; castShadow: true",position:"-11.089 19.35 -12.085"}},{type:"a-plane",attr:{rotation:"-90 0 0",width:"100",height:"100",color:"#009b00",shadow:""}},{type:"a-box",attr:{position:"5 2.5 -2.5",color:"#4CC3D9",material:"",geometry:"height:5;width:10",shadow:""}},{type:"a-box",attr:{position:"5 5.5 0",rotation:"90 0 0",color:"#4CC3D9",material:"",geometry:"height:5;width:10",shadow:""}},{type:"a-box",attr:{position:"5 2.5 2.5",color:"#4CC3D9",material:"",geometry:"height:5;width:10",shadow:""}},{template:"navNode",attr:{position:"-9 2 0",visible:"false"}},{template:"navNode",attr:{position:"0 2 0"}},{template:"navNode",attr:{position:"9 2 0"}}]}};AFRAME.registerComponent("lookat",{schema:{type:"selector",default:"[camera]"},init:function(){this.target=null},update:function(){if(console.log(this.data),this.data){if(!this.data.hasLoaded){var t=this;return t.data.addEventListener("loaded",function(){console.log("player loaded"),t.target=t.data.object3D})}this.target=this.data.object3D}},tick:function(){if(this.target){var t=this.el.object3D.parent.worldToLocal(this.target.getWorldPosition()),e=null;this.el.getObject3D("camera")?e.subVectors(this.el.object3D.position,t).add(this.el.object3D.position):e=t,this.el.object3D.lookAt(e)}}}),AFRAME.registerComponent("lost",{init:function(){this.loadScene("start.json")},tick:function(t,e){},loadScene:function(t){for(var e=this.el,i=LevelDef.level[t],a=0;a<i.length;a++){var o=i[a];this.buildElement(e,o)}},buildElement:function(t,e){var i={};"template"in e&&(i=LevelDef.template[e.template]);var a=document.createElement(this.coalesceVar("type",e,i)),o=this.mergeAttr(i,e);for(var r in o)a.setAttribute(r,o[r]);if("children"in i)for(r=0;r<i.children.length;r++)this.buildElement(a,i.children[r]);if("children"in e)for(r=0;r<e.children.length;r++)this.buildElement(a,e.children[r]);t.appendChild(a)},coalesceVar:function(t,e,i){return t in e?e[t]:i[t]},mergeAttr:function(t,e){var i={};if("attr"in t)for(var a in t.attr)i[a]=t.attr[a];if("attr"in e)for(var a in e.attr)i[a]=e.attr[a];return i}}),AFRAME.registerComponent("navigation",{init:function(){var t=this;this.el&&this.el.addEventListener("click",function(){t.click()})},click:function(){var t=this.el.sceneEl.querySelector("#player"),e=this.el.getAttribute("position"),i=t.getAttribute("position"),a=e.x+" "+i.y+" "+e.z,o=document.createElement("a-animation");o.setAttribute("attribute","position"),o.setAttribute("to",a),o.setAttribute("dur","500"),o.setAttribute("repeat","0"),t.appendChild(o),this.el.setAttribute("visible",!1);for(var r=this.el.sceneEl.querySelectorAll("[navigation]"),n=0;n<r.length;n++){var l=r[n];l!==this.el&&l.setAttribute("visible",!0)}}});</script></head><body><a-scene lost><a-entity id=player position="-9 0 0" camera=userHeight:1.6 wasd-controls rotation="0 270 0" look-controls><a-entity cursor="fuse: true; fuseTimeout: 1000;" position="0 0 -3" geometry="primitive:circle; radius: 0.2;" material="color: cyan; shader: flat;" scale="0.2 0.2 0.2" raycaster=objects:.clickable><a-animation begin=fusing end=mouseleave easing=ease-in attribute=scale from="1.0 1.0 1.0" to="0.2 0.2 0.2" fill=backwards duration=1000></a-animation></a-entity></a-entity></a-scene></body></html>